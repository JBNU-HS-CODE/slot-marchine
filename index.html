<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Slot Machine</title>

<style>
* {
    box-sizing: border-box;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
}

body {
    margin: 0;
    height: 100vh;
    background: radial-gradient(circle at top, #222 0%, #000 70%);
    display: flex;
    align-items: center;
    justify-content: center;
    color: #fff;
}

.machine {
    background: linear-gradient(180deg, #1a1a1a, #000);
    border-radius: 24px;
    padding: 32px;
    width: 440px;
    box-shadow:
        0 0 40px rgba(255, 215, 0, 0.15),
        inset 0 0 20px rgba(255,255,255,0.03);
}

.title {
    text-align: center;
    font-size: 28px;
    font-weight: 800;
    letter-spacing: 2px;
    margin-bottom: 12px;
    color: gold;
    text-shadow: 0 0 10px rgba(255,215,0,0.5);
}

.ticket {
    text-align: center;
    margin-bottom: 6px;
    font-size: 15px;
    font-weight: 600;
    color: #ffd700;
}

.ticket select {
    margin-left: 6px;
    background: #111;
    color: gold;
    border: 1px solid #444;
    border-radius: 8px;
    padding: 4px 8px;
    font-weight: 700;
    cursor: pointer;
}

.ticket select:focus {
    outline: none;
    box-shadow: 0 0 8px rgba(255,215,0,0.6);
}

.reels {
    display: flex;
    gap: 16px;
    justify-content: center;
    margin: 26px 0;
}

.reel {
    width: 80px;
    height: 100px;
    background: radial-gradient(circle at top, #222, #000);
    border-radius: 14px;
    overflow: hidden;
    position: relative;
    box-shadow:
        inset 0 0 10px rgba(0,0,0,0.8),
        0 0 12px rgba(255,215,0,0.25);
}

.numbers {
    position: absolute;
    width: 100%;
    top: 0;
}

.number {
    height: 100px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 48px;
    font-weight: 900;
    color: #fff;
    text-shadow:
        0 0 10px rgba(255,255,255,0.6),
        0 0 20px rgba(255,215,0,0.3);
}

.controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 12px;
}

button {
    flex: 1;
    background: linear-gradient(180deg, gold, #b8860b);
    border: none;
    border-radius: 999px;
    padding: 12px 0;
    font-size: 16px;
    font-weight: 800;
    cursor: pointer;
    box-shadow:
        0 6px 0 #7a5a00,
        0 10px 20px rgba(0,0,0,0.6);
    transition: transform 0.1s ease, box-shadow 0.1s ease;
}

button:hover {
    filter: brightness(1.1);
}

button:active {
    transform: translateY(4px);
    box-shadow:
        0 2px 0 #7a5a00,
        0 6px 12px rgba(0,0,0,0.6);
}

button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.result {
    margin-top: 16px;
    text-align: center;
    min-height: 24px;
    font-size: 18px;
    font-weight: 700;
    color: #0f0;
    text-shadow: 0 0 10px rgba(0,255,0,0.6);
}

.lose {
    color: #f33;
    text-shadow: 0 0 10px rgba(255,0,0,0.6);
}

/* ===== Leaderboard ===== */

.leaderboard {
    margin-top: 18px;
    border-top: 1px solid #333;
    padding-top: 10px;
}

.leaderboard h3 {
    margin: 6px 0 8px;
    text-align: center;
    color: gold;
    font-size: 16px;
    letter-spacing: 1px;
}

.leaderboard ul {
    list-style: none;
    padding: 0;
    margin: 0;
    max-height: 120px;
    overflow-y: auto;
}

.leaderboard li {
    font-size: 13px;
    padding: 4px 0;
    text-align: center;
    color: #ccc;
    border-bottom: 1px dashed #222;
}

.leaderboard li:last-child {
    border-bottom: none;
}

.leaderboard li:nth-child(1) {
    color: gold;
    font-weight: 700;
}

/* Scrollbar (because default is ugly) */
.leaderboard ul::-webkit-scrollbar {
    width: 6px;
}
.leaderboard ul::-webkit-scrollbar-thumb {
    background: #444;
    border-radius: 4px;
}
</style>
</head>

<body>
<div class="machine">
    <div class="title">SLOT MACHINE</div>
    <div class="ticket" id="ticketDisplay">Tickets: 0</div>
    <div class="ticket" id="clickDisplay">Clicks: 0 / 1000</div>

    <div class="ticket">
        Difficulty:
        <select id="difficultySelect">
            <option value="low">하 (7%)</option>
            <option value="mid">중 (1.5%)</option>
            <option value="high">상 (0.7%)</option>
            <option value="imposible">불가능(0.01%)<option>
        </select>
    </div>

    <div class="reels">
        <div class="reel"><div class="numbers"></div></div>
        <div class="reel"><div class="numbers"></div></div>
        <div class="reel"><div class="numbers"></div></div>
    </div>

    <div class="controls">
        <button id="spin">SPIN</button>
        <button id="buy">+1000 CLICK</button>
    </div>

    <div class="result" id="result"></div>

    <div class="leaderboard">
        <h3 style="text-align:center;color:gold;">LEADERBOARD</h3>
        <ul id="leaderboardList"></ul>
    </div>
</div>

<script>
const reels = document.querySelectorAll(".numbers");
const spinBtn = document.getElementById("spin");
const buyBtn = document.getElementById("buy");
const result = document.getElementById("result");
const ticketDisplay = document.getElementById("ticketDisplay");
const clickDisplay = document.getElementById("clickDisplay");

const SYMBOLS = [0,1,2,3,4,5,6,7,8,9];
const REPEAT = 20;
const JACKPOT_CHANCE = 0.0001;

const DIFFICULTY_RATE = {
    low: 0.07,
    mid: 0.015,
    high: 0.007,
    imposible: 0.0001
};

const difficultySelect = document.getElementById("difficultySelect");
const leaderboardList = document.getElementById("leaderboardList");

const url = new URL(location.href);
const params = url.searchParams;

let tickets = parseInt(params.get("ticket"), 10);
let clicks = parseInt(params.get("click"), 10);
let difficulty = params.get("difficulty") || "low";

if (isNaN(tickets) || tickets < 0) tickets = 0;
if (isNaN(clicks) || clicks < 0) clicks = 0;

difficultySelect.value = difficulty;

const leaderboard = JSON.parse(localStorage.getItem("leaderboard") || "[]");

function updateUrl() {
    params.set("ticket", tickets);
    params.set("click", clicks);
    params.set("difficulty", difficulty);
    history.replaceState(null, "", url.toString());
}

function render() {
    ticketDisplay.textContent = `Tickets: ${tickets}`;
    clickDisplay.textContent = `Clicks: ${clicks} / 1000`;
}

function renderLeaderboard() {
    leaderboardList.innerHTML = leaderboard
        .slice(-10)
        .reverse()
        .map(e =>
            `<li>${e.time} | ${e.difficulty.toUpperCase()} | ${e.value}${e.value}${e.value}</li>`
        )
        .join("");
}

function buildReel(reel) {
    reel.innerHTML = "";
    for (let i = 0; i < REPEAT; i++) {
        for (const n of SYMBOLS) {
            const div = document.createElement("div");
            div.className = "number";
            div.textContent = n;
            reel.appendChild(div);
        }
    }
}

reels.forEach(buildReel);
render();
renderLeaderboard();

difficultySelect.addEventListener("change", () => {
    difficulty = difficultySelect.value;
    updateUrl();
});

function spin() {
    if (tickets <= 0) {
        result.textContent = "No tickets";
        result.classList.add("lose");
        return;
    }

    tickets -= 1;
    updateUrl();
    render();

    spinBtn.disabled = true;
    result.textContent = "";

    const isJackpot = Math.random() < DIFFICULTY_RATE[difficulty];
    let finalValues;

    if (isJackpot) {
        const v = Math.floor(Math.random() * 10);
        finalValues = [v, v, v];
    } else {
        do {
            finalValues = [
                Math.floor(Math.random() * 10),
                Math.floor(Math.random() * 10),
                Math.floor(Math.random() * 10)
            ];
        } while (finalValues[0] === finalValues[1] && finalValues[1] === finalValues[2]);
    }

    reels.forEach((reel, i) => {
        const fullSpins = 1 + Math.floor(Math.random() * 3);
        const steps = fullSpins * SYMBOLS.length + finalValues[i];

        reel.style.transition = "none";
        reel.style.transform = "translateY(0)";
        reel.offsetHeight;

        reel.style.transition = `transform ${1.2 + i * 0.3}s cubic-bezier(.21,.61,.35,1)`;
        reel.style.transform = `translateY(-${steps * 100}px)`;
    });

    setTimeout(() => {
        spinBtn.disabled = false;
        if (isJackpot) {
            result.textContent = "JACKPOT!";
            leaderboard.push({
                time: new Date().toLocaleString(),
                difficulty,
                value: finalValues[0]
            });
            localStorage.setItem("leaderboard", JSON.stringify(leaderboard));
            renderLeaderboard();
        } else {
            result.textContent = "Try again";
            result.classList.add("lose");
        }
    }, 1800);
}

spinBtn.addEventListener("click", spin);

buyBtn.addEventListener("click", () => {
    clicks += 1;
    if (clicks >= 1000) {
        clicks -= 1000;
        tickets += 1;
    }
    updateUrl();
    render();
});

const CLICK_KEYS = new Set(["KeyA", "KeyS", "KeyD", "KeyJ", "KeyK", "KeyL"]);
document.addEventListener("keydown", (e) => {
    if (e.code === "Space") {
        e.preventDefault();
        if (!spinBtn.disabled) spin();
        return;
    }

    if (!CLICK_KEYS.has(e.code)) return;

    clicks += 1;
    if (clicks >= 1000) {
        clicks -= 1000;
        tickets += 1;
    }

    updateUrl();
    render();
});
</script>
</body>
</html>
