<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Slot Machine</title>

<style>
* {
    box-sizing: border-box;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
}

body {
    margin: 0;
    height: 100vh;
    background: radial-gradient(circle at top, #222 0%, #000 70%);
    display: flex;
    align-items: center;
    justify-content: center;
    color: #fff;
}

.machine {
    background: linear-gradient(180deg, #1a1a1a, #000);
    border-radius: 24px;
    padding: 32px;
    width: 420px;
    box-shadow: 0 0 40px rgba(255, 215, 0, 0.15);
}

.title {
    text-align: center;
    font-size: 28px;
    font-weight: 700;
    letter-spacing: 2px;
    margin-bottom: 10px;
    color: gold;
}

.ticket {
    text-align: center;
    margin-bottom: 6px;
    font-size: 16px;
    font-weight: 600;
    color: #ffd700;
}

.reels {
    display: flex;
    gap: 16px;
    justify-content: center;
    margin: 24px 0;
}

.reel {
    width: 80px;
    height: 100px;
    background: #111;
    border-radius: 12px;
    overflow: hidden;
    position: relative;
}

.numbers {
    position: absolute;
    width: 100%;
}

.number {
    height: 100px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 48px;
    font-weight: 800;
}

.controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

button {
    background: linear-gradient(180deg, gold, #b8860b);
    border: none;
    border-radius: 999px;
    padding: 12px 24px;
    font-size: 16px;
    font-weight: 700;
    cursor: pointer;
}

.result {
    margin-top: 16px;
    text-align: center;
    min-height: 24px;
    font-size: 18px;
}

.lose {
    color: #f33;
}
</style>
</head>

<body>
<div class="machine">
    <div class="title">SLOT MACHINE</div>
    <div class="ticket" id="ticketDisplay">Tickets: 0</div>
    <div class="ticket" id="clickDisplay">Clicks: 0 / 1000</div>

    <div class="reels">
        <div class="reel"><div class="numbers"></div></div>
        <div class="reel"><div class="numbers"></div></div>
        <div class="reel"><div class="numbers"></div></div>
    </div>

    <div class="controls">
        <button id="spin">SPIN</button>
        <button id="buy">+1000 CLICK</button>
    </div>

    <div class="result" id="result"></div>
</div>

<script>
const reels = document.querySelectorAll(".numbers");
const spinBtn = document.getElementById("spin");
const buyBtn = document.getElementById("buy");
const result = document.getElementById("result");
const ticketDisplay = document.getElementById("ticketDisplay");
const clickDisplay = document.getElementById("clickDisplay");

const SYMBOLS = [0,1,2,3,4,5,6,7,8,9];
const REPEAT = 20;
const JACKPOT_CHANCE = 0.0001;

const url = new URL(location.href);
const params = url.searchParams;

let tickets = parseInt(params.get("ticket"), 10);
let clicks = parseInt(params.get("click"), 10);

if (isNaN(tickets) || tickets < 0) tickets = 0;
if (isNaN(clicks) || clicks < 0) clicks = 0;

function updateUrl() {
    params.set("ticket", tickets);
    params.set("click", clicks);
    history.replaceState(null, "", url.toString());
}

function render() {
    ticketDisplay.textContent = `Tickets: ${tickets}`;
    clickDisplay.textContent = `Clicks: ${clicks} / 1000`;
}

function buildReel(reel) {
    reel.innerHTML = "";
    for (let i = 0; i < REPEAT; i++) {
        for (const n of SYMBOLS) {
            const div = document.createElement("div");
            div.className = "number";
            div.textContent = n;
            reel.appendChild(div);
        }
    }
}

reels.forEach(buildReel);
render();

function spin() {
    if (tickets <= 0) {
        result.textContent = "No tickets";
        result.classList.add("lose");
        return;
    }

    tickets -= 1;
    updateUrl();
    render();

    spinBtn.disabled = true;
    result.textContent = "";

    const isJackpot = Math.random() < JACKPOT_CHANCE;
    let finalValues;

    if (isJackpot) {
        const v = Math.floor(Math.random() * 10);
        finalValues = [v, v, v];
    } else {
        do {
            finalValues = [
                Math.floor(Math.random() * 10),
                Math.floor(Math.random() * 10),
                Math.floor(Math.random() * 10)
            ];
        } while (finalValues[0] === finalValues[1] && finalValues[1] === finalValues[2]);
    }

    reels.forEach((reel, i) => {
        const fullSpins = 1 + Math.floor(Math.random() * 3);
        const steps = fullSpins * SYMBOLS.length + finalValues[i];

        reel.style.transition = "none";
        reel.style.transform = "translateY(0)";
        reel.offsetHeight;

        reel.style.transition = `transform ${1.2 + i * 0.3}s cubic-bezier(.21,.61,.35,1)`;
        reel.style.transform = `translateY(-${steps * 100}px)`;
    });

    setTimeout(() => {
        spinBtn.disabled = false;
        result.textContent = isJackpot ? "JACKPOT!" : "Try again";
        result.classList.toggle("lose", !isJackpot);
    }, 1800);
}

spinBtn.addEventListener("click", spin);

buyBtn.addEventListener("click", () => {
    clicks += 1;
    if (clicks >= 1000) {
        clicks -= 1000;
        tickets += 1;
    }
    updateUrl();
    render();
});

const CLICK_KEYS = new Set(["KeyA", "KeyS", "KeyD", "KeyJ", "KeyK", "KeyL"]);
document.addEventListener("keydown", (e) => {
    if (e.code === "Space") {
        e.preventDefault();
        if (!spinBtn.disabled) spin();
        return;
    }

    if (!CLICK_KEYS.has(e.code)) return;

    clicks += 1;

    if (clicks >= 1000) {
        clicks -= 1000;
        tickets += 1;
    }

    updateUrl();
    render();
});

</script>
</body>
</html>
